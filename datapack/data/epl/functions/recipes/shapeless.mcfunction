execute store result score @s smithed.data if entity @s[scores={smithed.data=0}] if score count smithed.data matches 2 if data storage smithed:crafter root.temp{shapeless_crafting_input:[{item_tag:["#epl:enchantable"]},{tag:{epl:{id:"mystic_book"}}}]} if data storage smithed:crafter root.temp.shapeless_crafting_input[{tag:{epl:{id:"mystic_book"}}}].tag.epl.StoredEnchantments unless data storage smithed:crafter root.temp.shapeless_crafting_input[{item_tag:["#epl:enchantable"]}].tag.epl.Enchantments run function epl:recipes/enchant/main

execute store result score @s smithed.data if entity @s[scores={smithed.data=0}] if score count smithed.data matches 2 if data storage smithed:crafter root.temp{shapeless_crafting_input:[{Count:1b,id:"minecraft:chain_command_block",tag:{epl:{id:"mystic_book"}}},{Count:1b,id:"minecraft:chain_command_block",tag:{epl:{id:"mystic_book"}}}]} unless data storage smithed:crafter root.temp.shapeless_crafting_input[{item_tag:["#epl:enchantable"]}].tag.epl.Enchantments unless data storage smithed:crafter root.temp.shapeless_crafting_input[{tag:{epl:{id:"desecrated_char"}}}] run function epl:recipes/merge/main

execute store result score @s smithed.data if entity @s[scores={smithed.data=0}] if score count smithed.data matches 3 if data storage smithed:crafter root.temp{shapeless_crafting_input:[{Count:1b,id:"minecraft:chain_command_block",tag:{epl:{id:"alluring_powder"}}},{Count:1b,id:"minecraft:dragon_breath"},{Count:1b,id:"minecraft:soul_lantern"}]} run loot replace block ~ ~ ~ container.16 loot epl:blocks/enchanted_lantern

execute store result score @s smithed.data if entity @s[scores={smithed.data=0}] if score count smithed.data matches 3 if data storage smithed:crafter root.temp{shapeless_crafting_input:[{Count:1b,id:"minecraft:chain_command_block",tag:{epl:{id:"alluring_powder"}}},{Count:1b,id:"minecraft:rotten_flesh"},{Count:1b,id:"minecraft:charcoal"}]} run loot replace block ~ ~ ~ container.16 loot epl:items/desecrated_char

execute store result score @s smithed.data if entity @s[scores={smithed.data=0}] if score count smithed.data matches 2.. if data storage smithed:crafter root.temp{shapeless_crafting_input:[{Count:1b,id:"minecraft:chain_command_block",tag:{epl:{id:"mystic_book"}}},{id:"minecraft:chain_command_block",tag:{epl:{id:"desecrated_char"}}}]} run function epl:recipes/remove_one_ench/main