execute store result score @s smithed.data if entity @s[scores={smithed.data=0}] if score count smithed.data matches 2 if data storage smithed:crafter root.temp{shapeless_crafting_input:[{item_tag:["#epl:enchantable"]},{tag:{smithed:{id:"epl:mystic_book"}}}]} if data storage smithed:crafter root.temp.shapeless_crafting_input[{tag:{smithed:{id:"epl:mystic_book"}}}].tag.epl.StoredEnchantments unless data storage smithed:crafter root.temp.shapeless_crafting_input[{item_tag:["#epl:enchantable"]}].tag.epl.Enchantments run function epl:recipes/enchant/main

execute store result score @s smithed.data if entity @s[scores={smithed.data=0}] if score count smithed.data matches 2 if data storage smithed:crafter root.temp{shapeless_crafting_input:[{Count:1b,id:"minecraft:chain_command_block",tag:{smithed:{id:"epl:mystic_book"}}},{Count:1b,id:"minecraft:chain_command_block",tag:{smithed:{id:"epl:mystic_book"}}}]} unless data storage smithed:crafter root.temp.shapeless_crafting_input[{item_tag:["#epl:enchantable"]}].tag.epl.Enchantments run function epl:recipes/merge/main

execute store result score @s smithed.data if entity @s[scores={smithed.data=0}] if score count smithed.data matches 3 if data storage smithed:crafter root.temp{shapeless_crafting_input:[{Count:1b,id:"minecraft:chain_command_block",tag:{smithed:{id:"epl:alluring_powder"}}},{Count:1b,id:"minecraft:dragon_breath"},{Count:1b,id:"minecraft:soul_lantern"}]} run loot replace block ~ ~ ~ container.16 loot epl:blocks/enchanted_lantern